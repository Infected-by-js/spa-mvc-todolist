const t=["LOCAL_STORAGE","SESSION_STORAGE"],e={LOCAL_STORAGE:"Переключить на сессионное хранилище",SESSION_STORAGE:"Переключить на локальное хранилище"},s={LOCAL_STORAGE:"Текущее хранилище - Local Storage",SESSION_STORAGE:"Текущее хранилище - Session Storage"},n=[{title:"Мои дела",owner:"my"},{title:"Дела папы",owner:"dad"},{title:"Дела мамы",owner:"mom"}];const o={LOCAL_STORAGE:class{#t(t){return JSON.parse(t)}#e(t){return JSON.stringify(t)}constructor(t){this.owner=t}async getItems(){const t=this.#t(localStorage.getItem(this.owner))||[];return Promise.resolve(t)}async createItem(t){const e=await this.getItems(this.owner),s={...t,id:Date.now().toString(16)};return localStorage.setItem(this.owner,this.#e([s,...e])),Promise.resolve(s)}async updateItem(t){const e=(await this.getItems(this.owner)).map((e=>e.id===t.id?t:e));return localStorage.setItem(this.owner,this.#e(e)),Promise.resolve(t)}async deleteItem(t){const e=(await this.getItems(this.owner)).filter((({id:e})=>e!==t));return localStorage.setItem(this.owner,this.#e(e)),Promise.resolve(t)}},SESSION_STORAGE:class{#t(t){return JSON.parse(t)}#e(t){return JSON.stringify(t)}constructor(t){this.owner=t}async getItems(){const t=this.#t(sessionStorage.getItem(this.owner))||[];return Promise.resolve(t)}async createItem(t){const e=await this.getItems(this.owner),s={...t,id:Date.now().toString(16)};return sessionStorage.setItem(this.owner,this.#e([s,...e])),Promise.resolve(s)}async updateItem(t){const e=(await this.getItems(this.owner)).map((e=>e.id===t.id?t:e));return sessionStorage.setItem(this.owner,this.#e(e)),Promise.resolve(t)}async deleteItem(t){const e=(await this.getItems(this.owner)).filter((({id:e})=>e!==t));return sessionStorage.setItem(this.owner,this.#e(e)),Promise.resolve(t)}}};class i{constructor(t,e=[]){this.element=document.createElement(t),this.element.classList.add(...e)}}class r extends i{constructor(t,e){super("button",e),this.element.textContent=t}}class a extends i{constructor(t,e){super("h2",e),this.element.textContent=t}}class d extends i{constructor(){super("form",["input-group","mb-3","gap-3"]),this.input=new i("input",["form-control"]),this.buttonWrapper=new i("div",["input-group-append"]),this.button=new r("Добавить дело",["btn","btn-primary"]),this.input.element.placeholder="Введите название нового дела",this.input.element.setAttribute("autofocus",""),this.button.element.disabled=!0,this.buttonWrapper.element.append(this.button.element),this.element.append(this.input.element,this.buttonWrapper.element)}}class h extends i{constructor(t,e){super("nav",["nav","mb-5","justify-content-center"]),this.itemElements=t.map((({title:t,owner:s},n)=>{const{element:o}=new i("a",["nav-link","m-1"]);return o.dataset.id=s,o.textContent=t,o.href=0===n?"/":s,e===s&&o.classList.add("disabled"),o})),this.element.append(...this.itemElements)}}class l extends r{constructor(t){super(t,["btn","btn-warning","mb-3","w-100"])}}class c extends i{constructor({id:t,name:e,done:s}){super("li",["list-group-item","d-flex","justify-content-between","align-items-center"]),this.buttonsWrapp=new i("div",["btn-group","btn-group-sm","gap-2"]).element,this.doneButton=new r("Готово",["btn","btn-success"]).element,this.deleteButton=new r("Удалить",["btn","btn-danger"]).element,this.element.textContent=e,this.element.classList.toggle("list-group-item-success",s),this.element.dataset.id=t,this.doneButton.dataset.name="done",this.deleteButton.dataset.name="delete",this.buttonsWrapp.append(this.doneButton,this.deleteButton),this.element.append(this.buttonsWrapp)}}class m extends i{constructor(){super("ul",["list-group"])}}const u=document.getElementById("todo-app"),p=new class{constructor(t){this.rootElement=t}createPage=(t,o)=>{const i=e[o],r=n.find((({owner:e})=>e===t)).title;this.navigation=new h(n,t),this.title=new a(r),this.form=new d,this.todoList=new m,this.switchStoreButton=new l(i),this.storeTitle=new a(s[o],["fs-6","my-3"]),this.rootElement.textContent="",this.rootElement.append(this.navigation.element,this.title.element,this.form.element,this.storeTitle.element,this.switchStoreButton.element,this.todoList.element),this.form.element.addEventListener("input",this.handleInput)};createTodos=t=>{this.todoList.element.textContent="";const e=t.map((t=>new c(t).element));this.todoList.element.append(...e)};handleAddTodo(t){this.form.element.addEventListener("submit",(e=>{e.preventDefault();const s=this.form.input.element,n=this.form.button.element,o=s.value.trim();s.value="",n.disabled=!0,t(o)}))}handleChangeTodo(t,e){this.todoList.element.addEventListener("click",(s=>{const n=s.target?.closest("li")?.dataset?.id,o=s.target?.closest("button")?.dataset?.name;n&&o&&("done"===o?t(n):e(n))}))}handleChangeStore(t){this.switchStoreButton.element.addEventListener("click",t)}handleChangePage(t){this.navigation.element.addEventListener("click",(e=>{e.preventDefault();const s=e.target?.closest("a"),n=s?.dataset?.id;s&&n&&(t(n),window.history.pushState({page:n},n,s.href))}))}handlePopState(t){window.addEventListener("popstate",(e=>{const s=e.state?.page;if(!s)return t(n[0].owner);t(s)}))}handleInput=()=>{const t=this.form.input.element;this.form.button.element.disabled=!t.value.trim()}}(u),g=new class{#s=()=>{};#n(t){return{name:t,done:!1,owner:this.currentOwner}}constructor(e){this.currentOwner=window.location?.pathname?.split("/")?.pop()||n[0].owner,this.activeStore=t[0],this.todos=e||(async()=>await this.getTodos())()}todoStateUpdate(t){this.#s=t}async getTodos(){const t=new o[this.activeStore](this.currentOwner);this.todos=await t.getItems(),this.#s(this.todos)}async addTodo(t){const e=new o[this.activeStore](this.currentOwner),s=this.#n(t),n=await e.createItem(s);this.todos=[n,...this.todos],this.#s(this.todos)}async doneTodo(t){const e=new o[this.activeStore](this.currentOwner),s=this.todos.find((({id:e})=>e===t)),n=await e.updateItem({...s,done:!s.done});this.todos=this.todos.map((e=>e.id===t?n:e)),this.#s(this.todos)}async deleteTodo(t){const e=new o[this.activeStore](this.currentOwner);await e.deleteItem(t),this.todos=this.todos.filter((e=>e.id!==t)),this.#s(this.todos)}async changeActiveStore(){const e=t.indexOf(this.activeStore),s=e===t.length-1;this.activeStore=s?t[0]:t[e+1],await this.getTodos()}async changeCurrentPage(e){this.currentOwner=e,this.activeStore=t[0],await this.getTodos()}};new class{constructor(t,e){this.view=t,this.model=e,this.model.todoStateUpdate(this.view.createTodos),this.renderPage(),this.view.handlePopState(this.changePage)}renderPage=()=>{this.view.createPage(this.model.currentOwner,this.model.activeStore),this.view.handleAddTodo(this.addTodo),this.view.handleChangeTodo(this.doneTodo,this.deleteTodo),this.view.handleChangeStore(this.changeStore),this.view.handleChangePage(this.changePage)};addTodo=t=>{this.model.addTodo(t)};doneTodo=t=>{this.model.doneTodo(t)};deleteTodo=t=>{this.model.deleteTodo(t)};changeStore=()=>{this.model.changeActiveStore(),this.renderPage()};changePage=t=>{this.model.changeCurrentPage(t),this.renderPage()}}(p,g);
//# sourceMappingURL=index.bd1bc9ca.js.map
