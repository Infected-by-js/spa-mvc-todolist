var D=Object.defineProperty,J=Object.defineProperties;var U=Object.getOwnPropertyDescriptors;var W=Object.getOwnPropertySymbols;var j=Object.prototype.hasOwnProperty,F=Object.prototype.propertyIsEnumerable;var O=(o,t,e)=>t in o?D(o,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):o[t]=e,w=(o,t)=>{for(var e in t||(t={}))j.call(t,e)&&O(o,e,t[e]);if(W)for(var e of W(t))F.call(t,e)&&O(o,e,t[e]);return o},S=(o,t)=>J(o,U(t));var a=(o,t,e)=>(O(o,typeof t!="symbol"?t+"":t,e),e),P=(o,t,e)=>{if(!t.has(o))throw TypeError("Cannot "+e)};var g=(o,t,e)=>(P(o,t,"read from private field"),e?e.call(o):t.get(o)),l=(o,t,e)=>{if(t.has(o))throw TypeError("Cannot add the same private member more than once");t instanceof WeakSet?t.add(o):t.set(o,e)},G=(o,t,e,s)=>(P(o,t,"write to private field"),s?s.call(o,e):t.set(o,e),e);var d=(o,t,e)=>(P(o,t,"access private method"),e);const M=function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))s(n);new MutationObserver(n=>{for(const i of n)if(i.type==="childList")for(const r of i.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&s(r)}).observe(document,{childList:!0,subtree:!0});function e(n){const i={};return n.integrity&&(i.integrity=n.integrity),n.referrerpolicy&&(i.referrerPolicy=n.referrerpolicy),n.crossorigin==="use-credentials"?i.credentials="include":n.crossorigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function s(n){if(n.ep)return;n.ep=!0;const i=e(n);fetch(n.href,i)}};M();const L="LOCAL_STORAGE",E="SESSION_STORAGE",m=[L,E],q={[L]:"\u041F\u0435\u0440\u0435\u043A\u043B\u044E\u0447\u0438\u0442\u044C \u043D\u0430 \u0441\u0435\u0441\u0441\u0438\u043E\u043D\u043D\u043E\u0435 \u0445\u0440\u0430\u043D\u0438\u043B\u0438\u0449\u0435",[E]:"\u041F\u0435\u0440\u0435\u043A\u043B\u044E\u0447\u0438\u0442\u044C \u043D\u0430 \u043B\u043E\u043A\u0430\u043B\u044C\u043D\u043E\u0435 \u0445\u0440\u0430\u043D\u0438\u043B\u0438\u0449\u0435"},H={[L]:"\u0422\u0435\u043A\u0443\u0449\u0435\u0435 \u0445\u0440\u0430\u043D\u0438\u043B\u0438\u0449\u0435 - Local Storage",[E]:"\u0422\u0435\u043A\u0443\u0449\u0435\u0435 \u0445\u0440\u0430\u043D\u0438\u043B\u0438\u0449\u0435 - Session Storage"},T=[{title:"\u041C\u043E\u0438 \u0434\u0435\u043B\u0430",owner:"my"},{title:"\u0414\u0435\u043B\u0430 \u043F\u0430\u043F\u044B",owner:"dad"},{title:"\u0414\u0435\u043B\u0430 \u043C\u0430\u043C\u044B",owner:"mom"}];var I,V,u,C;class K{constructor(t){l(this,I);l(this,u);this.owner=t}async getItems(){const t=d(this,I,V).call(this,localStorage.getItem(this.owner))||[];return Promise.resolve(t)}async createItem(t){const e=await this.getItems(this.owner),s=S(w({},t),{id:Date.now().toString(16)});return localStorage.setItem(this.owner,d(this,u,C).call(this,[s,...e])),Promise.resolve(s)}async updateItem(t){const s=(await this.getItems(this.owner)).map(n=>n.id===t.id?t:n);return localStorage.setItem(this.owner,d(this,u,C).call(this,s)),Promise.resolve(t)}async deleteItem(t){const s=(await this.getItems(this.owner)).filter(({id:n})=>n!==t);return localStorage.setItem(this.owner,d(this,u,C).call(this,s)),Promise.resolve(t)}}I=new WeakSet,V=function(t){return JSON.parse(t)},u=new WeakSet,C=function(t){return JSON.stringify(t)};var b,Q,p,x;class z{constructor(t){l(this,b);l(this,p);this.owner=t}async getItems(){const t=d(this,b,Q).call(this,sessionStorage.getItem(this.owner))||[];return Promise.resolve(t)}async createItem(t){const e=await this.getItems(this.owner),s=S(w({},t),{id:Date.now().toString(16)});return sessionStorage.setItem(this.owner,d(this,p,x).call(this,[s,...e])),Promise.resolve(s)}async updateItem(t){const s=(await this.getItems(this.owner)).map(n=>n.id===t.id?t:n);return sessionStorage.setItem(this.owner,d(this,p,x).call(this,s)),Promise.resolve(t)}async deleteItem(t){const s=(await this.getItems(this.owner)).filter(({id:n})=>n!==t);return sessionStorage.setItem(this.owner,d(this,p,x).call(this,s)),Promise.resolve(t)}}b=new WeakSet,Q=function(t){return JSON.parse(t)},p=new WeakSet,x=function(t){return JSON.stringify(t)};const f={[L]:K,[E]:z};var h,y,Y;class X{constructor(t){l(this,y);l(this,h,()=>{});var e,s,n;this.currentOwner=((n=(s=(e=window.location)==null?void 0:e.pathname)==null?void 0:s.split("/"))==null?void 0:n.pop())||T[0].owner,this.activeStore=m[0],this.todos=t||(async()=>await this.getTodos())()}todoStateUpdate(t){G(this,h,t)}async getTodos(){const t=new f[this.activeStore](this.currentOwner);this.todos=await t.getItems(),g(this,h).call(this,this.todos)}async addTodo(t){const e=new f[this.activeStore](this.currentOwner),s=d(this,y,Y).call(this,t),n=await e.createItem(s);this.todos=[n,...this.todos],g(this,h).call(this,this.todos)}async doneTodo(t){const e=new f[this.activeStore](this.currentOwner),s=this.todos.find(({id:i})=>i===t),n=await e.updateItem(S(w({},s),{done:!s.done}));this.todos=this.todos.map(i=>i.id===t?n:i),g(this,h).call(this,this.todos)}async deleteTodo(t){await new f[this.activeStore](this.currentOwner).deleteItem(t),this.todos=this.todos.filter(s=>s.id!==t),g(this,h).call(this,this.todos)}async changeActiveStore(){const t=m.indexOf(this.activeStore);t===m.length-1?this.activeStore=m[0]:this.activeStore=m[t+1],await this.getTodos()}async changeCurrentPage(t){this.currentOwner=t,this.activeStore=m[0],await this.getTodos()}}h=new WeakMap,y=new WeakSet,Y=function(t){return{name:t,done:!1,owner:this.currentOwner}};class c{constructor(t,e=[]){this.element=document.createElement(t),this.element.classList.add(...e)}}class v extends c{constructor(t,e){super("button",e);this.element.textContent=t}}class k extends c{constructor(t,e){super("h2",e);this.element.textContent=t}}class Z extends c{constructor(){super("form",["input-group","mb-3","gap-3"]);this.input=new c("input",["form-control"]),this.buttonWrapper=new c("div",["input-group-append"]),this.button=new v("\u0414\u043E\u0431\u0430\u0432\u0438\u0442\u044C \u0434\u0435\u043B\u043E",["btn","btn-primary"]),this.input.element.placeholder="\u0412\u0432\u0435\u0434\u0438\u0442\u0435 \u043D\u0430\u0437\u0432\u0430\u043D\u0438\u0435 \u043D\u043E\u0432\u043E\u0433\u043E \u0434\u0435\u043B\u0430",this.input.element.setAttribute("autofocus",""),this.button.element.disabled=!0,this.buttonWrapper.element.append(this.button.element),this.element.append(this.input.element,this.buttonWrapper.element)}}class $ extends c{constructor(t,e){super("nav",["nav","mb-5","justify-content-center"]);this.itemElements=t.map(({title:s,owner:n},i)=>{const{element:r}=new c("a",["nav-link","m-1"]);return r.dataset.id=n,r.textContent=s,r.href=i===0?"/":n,e===n&&r.classList.add("disabled"),r}),this.element.append(...this.itemElements)}}class tt extends v{constructor(t){super(t,["btn","btn-warning","mb-3","w-100"])}}class et extends c{constructor({id:t,name:e,done:s}){super("li",["list-group-item","d-flex","justify-content-between","align-items-center"]);this.buttonsWrapp=new c("div",["btn-group","btn-group-sm","gap-2"]).element,this.doneButton=new v("\u0413\u043E\u0442\u043E\u0432\u043E",["btn","btn-success"]).element,this.deleteButton=new v("\u0423\u0434\u0430\u043B\u0438\u0442\u044C",["btn","btn-danger"]).element,this.element.textContent=e,this.element.classList.toggle("list-group-item-success",s),this.element.dataset.id=t,this.doneButton.dataset.name="done",this.deleteButton.dataset.name="delete",this.buttonsWrapp.append(this.doneButton,this.deleteButton),this.element.append(this.buttonsWrapp)}}class st extends c{constructor(){super("ul",["list-group"])}}class nt{constructor(t){a(this,"createPage",(t,e)=>{const s=q[e],n=T.find(({owner:i})=>i===t).title;this.navigation=new $(T,t),this.title=new k(n),this.form=new Z,this.todoList=new st,this.switchStoreButton=new tt(s),this.storeTitle=new k(H[e],["fs-6","my-3"]),this.rootElement.textContent="",this.rootElement.append(this.navigation.element,this.title.element,this.form.element,this.storeTitle.element,this.switchStoreButton.element,this.todoList.element),this.form.element.addEventListener("input",this.handleInput)});a(this,"createTodos",t=>{this.todoList.element.textContent="";const e=t.map(s=>new et(s).element);this.todoList.element.append(...e)});a(this,"handleInput",()=>{const t=this.form.input.element,e=this.form.button.element;e.disabled=!t.value.trim()});this.rootElement=t}handleAddTodo(t){this.form.element.addEventListener("submit",e=>{e.preventDefault();const s=this.form.input.element,n=this.form.button.element,i=s.value.trim();s.value="",n.disabled=!0,t(i)})}handleChangeTodo(t,e){this.todoList.element.addEventListener("click",s=>{var r,A,B,N,R,_;const n=(B=(A=(r=s.target)==null?void 0:r.closest("li"))==null?void 0:A.dataset)==null?void 0:B.id,i=(_=(R=(N=s.target)==null?void 0:N.closest("button"))==null?void 0:R.dataset)==null?void 0:_.name;!n||!i||(i==="done"?t(n):e(n))})}handleChangeStore(t){this.switchStoreButton.element.addEventListener("click",t)}handleChangePage(t){this.navigation.element.addEventListener("click",e=>{var i,r;e.preventDefault();const s=(i=e.target)==null?void 0:i.closest("a"),n=(r=s==null?void 0:s.dataset)==null?void 0:r.id;!s||!n||(t(n),window.history.pushState({page:n},n,s.href))})}handlePopState(t){window.addEventListener("popstate",e=>{var n;const s=(n=e.state)==null?void 0:n.page;if(!s)return t(T[0].owner);t(s)})}}class ot{constructor(t,e){a(this,"renderPage",()=>{this.view.createPage(this.model.currentOwner,this.model.activeStore),this.view.handleAddTodo(this.addTodo),this.view.handleChangeTodo(this.doneTodo,this.deleteTodo),this.view.handleChangeStore(this.changeStore),this.view.handleChangePage(this.changePage)});a(this,"addTodo",t=>{this.model.addTodo(t)});a(this,"doneTodo",t=>{this.model.doneTodo(t)});a(this,"deleteTodo",t=>{this.model.deleteTodo(t)});a(this,"changeStore",()=>{this.model.changeActiveStore(),this.renderPage()});a(this,"changePage",t=>{this.model.changeCurrentPage(t),this.renderPage()});this.view=t,this.model=e,this.model.todoStateUpdate(this.view.createTodos),this.renderPage(),this.view.handlePopState(this.changePage)}}const it=document.getElementById("todo-app"),rt=new nt(it),at=new X;new ot(rt,at);
